!function(){function i(){r=document.getElementById("invadersCanvas"),l=window.innerWidth,o=window.innerHeight,l=800,o=l/1.5,r.width=l,r.height=o;var i=document.getElementById("game");i.style.width=l+"px",i.style.height=o+"px",input=new h,p=w.Splash,c=r.getContext("2d"),d=new Image,d.src="res/sprite_sheet.png",d.src="res/sprite_sheet-transparent.png",d.onload=function(){initSprites(this),a=n(50),f=0,g.init(),y.init(),v.init(),t()}}function t(){var i=function(){s(),e(),window.requestAnimationFrame(i)};i()}function s(){f++,p===w.Game&&y.update(),g.update(),v.update()}function e(){c.fillStyle="#333",c.fillRect(0,0,l,o),c.fillStyle="#000",c.fillRect(10,10,l-20,o-20),y.draw(c),g.draw(c),v.draw(c),p!==w.Game&&(c.fillStyle="rgba(0, 0, 0, .8)",c.fillRect(0,0,l,o),s_title.draw(c,l/2-s_title.width/2,100))}function n(i){var t=i||20,s=function(){c.fillStyle="rgba(255,255,255,.5)",c.fillRect(Math.random()*o,Math.random()*l,3*Math.random(),3*Math.random()),c.fill()};c.clearRect(0,0,l,o),c.fillStyle="rgba(0,0,0,1)",c.fillRect(0,0,l,o);for(var e=0;t>e;e++)s();var n=r.toDataURL("image/png").replace("image/png","image/octet-stream");a=n;var h=new Image;return h.src=n,h}function h(){this.down={},this.pressed={};var i=this;document.addEventListener("keydown",function(t){13===t.which&&(p===w.Splash?(p=w.Game,u=[]):p===w.Game?p=w.Splash:p===w.End&&(p=w.Game,y.init())),i.down[t.which]=!0}),document.addEventListener("keyup",function(t){i.down[t.which]=!1,i.pressed[t.which]=!1})}var r,a,o,l,c,d,f,p,u=[],w={Splash:0,Game:1,End:2},y={_aliens:[],rows:[0,1,1,2,2],cols:10,x:20,y:60,step:30,frame:0,dir:1,animation:[0,1],velocity:60,init:function(){this.velocity=60,u=[],this._aliens=[];for(var i=0;i<this.rows.length;i++)for(var t=0;t<this.cols;t++){var s=this.x+this.step*t,e=this.y+this.step*i;this._aliens.push({sprite:s_alien[this.rows[i]],x:s,y:e,w:s_alien[this.rows[i]][0].width,h:s_alien[this.rows[i]][0].height})}},update:function(){0===this._aliens.length&&(y.init(),p=w.Splash);for(var i=0,t=this._aliens.length;t>i;i++)for(var s=0,e=u.length;e>s;s++){var n=this._aliens[i],h=u[s];try{h.x>n.x&&h.x<n.x+n.w&&h.y>=n.y&&h.y<=n.y+n.h&&(this._aliens.splice(i,1),i--,t--,u.splice(s,1),s--,e--)}catch(r){console.log("err: "+r.toString())}}if(this.velocity=this._aliens.length+6,f%10===0&&Math.random()<.1){var n=this._aliens[Math.floor(Math.random()*this._aliens.length)];u.push({f:0,sprite:s_bulletAlien,x:n.x,y:n.y-2,v:2,dir:1})}if(f%this.velocity==0){this.frame++;for(var a=l,o=0,i=0,t=this._aliens.length;t>i;i++){var n=this._aliens[i];n.x+=this.step*this.dir,a=Math.min(n.x,a),o=Math.max(n.x,o)}if(30>a||o>l-30-this.step){this.dir*=-1;for(var i=0,t=this._aliens.length;t>i;i++)this._aliens[i].x+=this.step*this.dir,this._aliens[i].y+=this.step}}},draw:function(i){i.save();for(var t=0,s=this._aliens.length;s>t;t++){var e=this._aliens[t];e.sprite[this.frame%this.animation.length].draw(i,e.x,e.y)}i.restore()}},g={x:0,y:0,w:0,h:0,init:function(){this.x=l/2,this.y=o-75,this.w=s_ship.width,this.h=s_ship.height},update:function(){for(var i=0,t=u.length;t>i;i++){var s=u[i];f%30==0&&s.f++,s.y+=s.v*s.dir,(s.y<0||s.y>o)&&(u.splice(i,1),i--,t--);try{if(s.x>this.x&&s.x<this.x+this.w&&s.y>=this.y&&s.y<=this.y+this.h)return void(p=w.End)}catch(e){console.log("err: "+e.toString())}}if(input.isPressed(32)&&u.push({f:0,sprite:s_bulletShip,x:this.x+this.w/2,y:this.y+2,v:3,dir:-1}),input.isDown(37)){if(this.x<30)return;input.shiftModified()?this.x-=4:this.x-=2}if(input.isDown(39)){if(this.x>l-30-g.width)return;input.shiftModified()?this.x+=4:this.x+=2}},draw:function(){s_ship.draw(c,this.x,o-75);for(var i=0,t=u.length;t>i;i++){var s=u[i];s.sprite[s.f%2].draw(c,s.x,s.y)}}},v={_cities:[],step:138,num:5,x:0,y:0,w:0,h:0,init:function(){this.w=s_city[0].width,this.h=s_city[0].height;for(var i=0;i<this.num;i++)this._cities.push({sprite:s_city,x:100+this.step*i,y:o-150,hits:0,w:this.w,h:this.h})},update:function(){for(var i=0,t=this._cities.length;t>i;i++)for(var s=0,e=u.length;e>s;s++){var n=this._cities[i],h=u[s];console.log(h.x);try{h.x>n.x&&h.x<n.x+n.w&&h.y>=n.y&&h.y<=n.y+n.h&&(console.log("HIT"),u.splice(s,1),s--,e--,n.hits++,n.hits>4&&(this._cities.splice(i,1),i--,t--))}catch(r){}}},draw:function(i){for(var t=0,s=this._cities.length;s>t;t++){var e=this._cities[t];f%100==0&&console.log(e),e.sprite[0].draw(i,e.x,e.y)}}};h.prototype.isDown=function(i){return this.down[i]},h.prototype.isPressed=function(i){return this.pressed[i]?!1:this.down[i]?this.pressed[i]=!0:!1},h.prototype.shiftModified=function(){return this.isDown(16)},i()}();