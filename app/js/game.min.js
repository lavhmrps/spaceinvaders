!function(){function i(){h=document.getElementById("invadersCanvas"),a=window.innerWidth,r=window.innerHeight,a=800,r=a/1.5,h.width=a,h.height=r,input=new n,p=c.Splash,o=h.getContext("2d"),l=new Image,l.src="res/sprite_sheet.png",l.src="res/sprite_sheet-transparent.png",l.onload=function(){initSprites(this),o.fillStyle=s_bgColor,o.fillRect(0,0,a,r),d=0,w.init(),u.init(),t()}}function t(){var i=function(){s(),e(),window.requestAnimationFrame(i)};i()}function s(){d++,p===c.Game&&u.update(),w.update()}function e(){o.fillStyle=s_bgColor,o.fillRect(0,0,a,r),o.stroke(),u.draw(o),w.draw(o),p!==c.Game&&(o.fillStyle="rgba(31, 40, 45, .8)",o.fillRect(0,0,a,r),s_title.draw(o,a/2-s_title.width/2,100))}function n(){this.down={},this.pressed={};var i=this;document.addEventListener("keydown",function(t){13===t.which&&(p===c.Splash?(p=c.Game,f=[]):p===c.Game?p=c.Splash:p===c.End&&(p=c.Game,u.init())),i.down[t.which]=!0}),document.addEventListener("keyup",function(t){i.down[t.which]=!1,i.pressed[t.which]=!1})}var h,r,a,o,l,d,p,f=[],c={Splash:0,Game:1,End:2},u={_aliens:[],rows:[0,1,1,2,2],cols:10,x:20,y:60,step:30,frame:0,dir:1,animation:[0,1],velocity:60,init:function(){this.velocity=60,f=[],this._aliens=[];for(var i=0;i<this.rows.length;i++)for(var t=0;t<this.cols;t++){var s=this.x+this.step*t,e=this.y+this.step*i;this._aliens.push({sprite:s_alien[this.rows[i]],x:s,y:e,w:s_alien[this.rows[i]][0].width,h:s_alien[this.rows[i]][0].height})}},update:function(){0===this._aliens.length&&(u.init(),p=c.Splash);for(var i=0,t=this._aliens.length;t>i;i++)for(var s=0,e=f.length;e>s;s++){var n=this._aliens[i],h=f[s];try{h.x>n.x&&h.x<n.x+n.w&&h.y>=n.y&&h.y<=n.y+n.h&&(this._aliens.splice(i,1),i--,t--,f.splice(s,1),s--,e--,this.velocity=this._aliens.length+6)}catch(r){console.log("err: "+r.toString())}}if(d%10===0&&Math.random()<.1){var n=this._aliens[Math.floor(Math.random()*this._aliens.length)];f.push({sprite:s_bulletAlien,x:n.x,y:n.y-2,v:2,dir:1}),console.log("SPACEFIRE")}if(d%this.velocity==0){this.frame++;for(var o=a,l=0,i=0,t=this._aliens.length;t>i;i++){var n=this._aliens[i];n.x+=this.step*this.dir,o=Math.min(n.x,o),l=Math.max(n.x,l)}if(30>o||l>a-30-this.step){this.dir*=-1;for(var i=0,t=this._aliens.length;t>i;i++)this._aliens[i].x+=this.step*this.dir,this._aliens[i].y+=this.step}}},draw:function(i){i.save();for(var t=0,s=this._aliens.length;s>t;t++){var e=this._aliens[t];e.sprite[this.frame%this.animation.length].draw(i,e.x,e.y)}i.restore()}},w={x:0,y:0,w:0,h:0,init:function(){this.x=a/2,this.y=r-75,this.w=s_ship.width,this.h=s_ship.height},update:function(){for(var i=0,t=f.length;t>i;i++){var s=f[i];s.y+=s.v*s.dir,(s.y<0||s.y>r)&&(f.splice(i,1),i--,t--);try{if(s.x>this.x&&s.x<this.x+this.w&&s.y>=this.y&&s.y<=this.y+this.h)return void(p=c.End)}catch(e){console.log("err: "+e.toString())}}if(input.isPressed(32)&&f.push({sprite:s_bulletShip,x:this.x,y:this.y+2,v:3,dir:-1}),input.isDown(37)){if(this.x<30)return;input.shiftModified()?this.x-=4:this.x-=2}if(input.isDown(39)){if(this.x>a-30-w.width)return;input.shiftModified()?this.x+=4:this.x+=2}},draw:function(){s_ship.draw(o,this.x,r-75);for(var i=0,t=f.length;t>i;i++){var s=f[i];s.sprite.draw(o,s.x,s.y)}}};n.prototype.isDown=function(i){return this.down[i]},n.prototype.isPressed=function(i){return this.pressed[i]?!1:this.down[i]?this.pressed[i]=!0:!1},n.prototype.shiftModified=function(){return this.isDown(16)},i()}();